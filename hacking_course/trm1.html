<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kali Linux Terminal Clone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0d0d0d;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .terminal-container {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }
        
        .prompt-line {
            display: flex;
        }

        .terminal-line {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .prompt {
            white-space: nowrap;
            margin-right: 8px;
        }
        
        /* Color Styles */
        .prompt-blue {
            color: #44aadd;
        }

        .prompt-red {
            color: #ff3333;
        }

        .color-white {
            color: #ffffff;
        }

        .color-yellow {
            color: #ffff00;
        }

        .color-cyan {
            color: #00ffff;
        }
        
        .input-container {
            display: flex;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .input-field {
            background: transparent;
            border: none;
            outline: none;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            flex: 1;
            caret-color: transparent;
            padding-left: 1px;
        }

        .cursor {
            position: absolute;
            left: 0;
            top: 0;
            background-color: #ffffff;
            width: 9px;
            height: 19px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% {
                opacity: 1;
            }
            51%, 100% {
                opacity: 0;
            }
        }

        .output {
            white-space: pre-wrap;
            word-break: break-all;
        }

        .help-output {
            background-color: #1a1a1a;
            border-left: 3px solid #44aadd;
            padding: 10px 15px;
            margin: 5px 0;
            color: #ffffff;
            max-width: 800px;
        }

        .help-title {
            color: #44aadd;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .help-section {
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .help-command {
            color: #ffff00;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            body, .input-field {
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            body, .input-field {
                font-size: 12px;
            }
            .cursor {
                height: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="terminal-container" id="terminal">
        <!-- Terminal lines will be generated by JavaScript -->
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const terminal = document.getElementById('terminal');
    let commandHistory = [];

    // --- Virtual File System ---
    const fileSystem = {
        'Desktop': {},
        'Documents': {
            'report.txt': 'Congratulations! You are doing so well. Best of luck!',
            'notes.md': '# Important Notes\n- Task 1: Complete project\n- Task 2: Review code',
            'passwords.txt': 'username: admin\npassword: kali123'
        },
        'Downloads': {
            'hacktools.tar.gz': 'Compressed hacking tools',
            'script.py': '#!/usr/bin/python3\nprint("Hello World")'
        },
        'Music': {},
        'Pictures': {},
        'Videos': {}
    };
    let currentPath = [];

    function getCwd() {
        let dir = fileSystem;
        for (const part of currentPath) {
            dir = dir[part];
        }
        return dir;
    }

    function getPathString() {
        if (currentPath.length === 0) return '~';
        return `~/${currentPath.join('/')}`;
    }

    // --- Helper Functions ---
    const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));
    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const randMAC = () => [...Array(6)].map(() => Math.floor(Math.random() * 256).toString(16).padStart(2, '0')).join(':');
    const randIP = () => [...Array(4)].map(() => randInt(0, 255)).join('.');
    const randIPv6 = () => [...Array(8)].map(() => Math.floor(Math.random() * 65536).toString(16)).join(':');

    function escapeHTML(str) {
        const p = document.createElement('p');
        p.appendChild(document.createTextNode(str));
        return p.innerHTML;
    }

    function createNewInputLine() {
        const wrapper = document.createElement('div');
        wrapper.className = 'command-wrapper';
        const path = getPathString();
        const escapedPath = escapeHTML(path);

        const promptLine1 = `<div class="prompt-line"><span class="prompt-blue">┌──(</span><span class="prompt-red">root㉿kali-linux</span><span class="prompt-blue">)-[</span><span class="color-white">${escapedPath}</span><span class="prompt-blue">]</span></div>`;
        
        wrapper.innerHTML = `
            ${promptLine1}
            <div class="prompt-line terminal-line">
                <div class="prompt">
                    <span class="prompt-blue">└─</span><span class="prompt-red">#</span>&nbsp;
                </div>
                <div class="input-container">
                    <span class="cursor"></span>
                    <input type="text" class="input-field" autofocus>
                </div>
            </div>
        `;
        
        const inputField = wrapper.querySelector('.input-field');
        inputField.addEventListener('keydown', handleEnter);
        
        terminal.appendChild(wrapper);
        inputField.focus();
        
        updateCursorPosition({ target: inputField });

        inputField.addEventListener('input', updateCursorPosition);
        inputField.addEventListener('click', updateCursorPosition);
        inputField.addEventListener('keydown', updateCursorPosition);
    }

    function updateCursorPosition(e) {
        const inputField = e.target;
        setTimeout(() => {
            const cursor = inputField.previousElementSibling;
            const text = inputField.value.substring(0, inputField.selectionStart);
            const style = window.getComputedStyle(inputField);
            const font = `${style.fontSize} ${style.fontFamily}`;
            const paddingLeft = parseFloat(style.paddingLeft);

            const textWidth = getTextWidth(text, font);
            cursor.style.transform = `translateX(${paddingLeft + textWidth}px)`;
        }, 0);
    }

    function getTextWidth(text, font) {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        context.font = font;
        return context.measureText(text).width;
    }

    async function handleEnter(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            
            const inputField = e.target;
            const command = inputField.value.trim();
            const escapedCommand = escapeHTML(command);
            const currentWrapper = inputField.closest('.command-wrapper');
            
            inputField.setAttribute('readonly', true);
            currentWrapper.querySelector('.cursor').style.display = 'none';

            const promptLine2 = currentWrapper.querySelector('.prompt-line.terminal-line');
            promptLine2.innerHTML = `
                <div class="prompt">
                    <span class="prompt-blue">└─</span><span class="prompt-red">#</span>&nbsp;
                </div>
                <div class="output color-white">${escapedCommand}</div>
            `;
            
            if (command !== '') {
                commandHistory.push(command);
                await processCommand(command, currentWrapper);
            }

            createNewInputLine();
            terminal.scrollTop = terminal.scrollHeight;
        }
    }

    async function processCommand(command, wrapper) {
        const [cmd, ...args] = command.split(' ');
        
        // Check for help flag first
        if (args.includes('-h') || args.includes('--help')) {
            showCommandHelp(lowerCmd, wrapper);
            return;
        }
        
        let output = '';
        
        switch (cmd) {
            case 'help':
                output = 'Available commands: help, whoami, pwd, ls, cd, cat, touch, mkdir, date, clear, history, uname, neofetch, ping, ifconfig, iwconfig, apt, echo\n\nUse "command --help" for detailed information about each command.';
                addOutput(output, wrapper);
                break;
            case 'whoami':
                output = 'root';
                addOutput(output, wrapper);
                break;
            case 'pwd':
                output = `/root${currentPath.length > 0 ? '/' : ''}${currentPath.join('/')}`;
                addOutput(output, wrapper);
                break;
            case 'ls':
                const cwdLs = getCwd();
                if (args.length === 0) {
                    // No arguments - list current directory
                    output = Object.keys(cwdLs).length > 0 ? Object.keys(cwdLs).join('  ') : '';
                    addOutput(output, wrapper);
                } else {
                    // With arguments - check each file/directory
                    let validItems = [];
                    let errors = [];
                    
                    args.forEach(arg => {
                        if (cwdLs[arg] !== undefined) {
                            validItems.push(arg);
                        } else {
                            errors.push(`ls: cannot access '${arg}': No such file or directory`);
                        }
                    });
                    
                    if (validItems.length > 0) {
                        addOutput(validItems.join('  '), wrapper);
                    }
                    if (errors.length > 0) {
                        addOutput(errors.join('\n'), wrapper);
                    }
                }
                break;
            case 'cd':
                const target = args[0];
                if (!target || target === '~' || target === '/root' || target === '/home') {
                    currentPath = [];
                } else if (target === '..') {
                    if (currentPath.length > 0) {
                        currentPath.pop();
                    }
                } else {
                    const cwdCd = getCwd();
                    if (cwdCd[target] && typeof cwdCd[target] === 'object') {
                        currentPath.push(target);
                    } else if (cwdCd[target] && typeof cwdCd[target] !== 'object') {
                         addOutput(`bash: cd: ${target}: Not a directory`, wrapper);
                    } else {
                        addOutput(`bash: cd: ${target}: No such file or directory`, wrapper);
                    }
                }
                break;
            case 'cat':
                const filename = args[0];
                const cwdCat = getCwd();
                if (filename && cwdCat[filename] !== undefined && typeof cwdCat[filename] === 'string') {
                    output = cwdCat[filename] || '\n';
                } else {
                    output = `cat: ${filename || ''}: No such file or directory`;
                }
                addOutput(output, wrapper);
                break;
            case 'touch':
                if (args[0]) getCwd()[args[0]] = '';
                break;
            case 'mkdir':
                if (args[0]) getCwd()[args[0]] = {};
                break;
            case 'history':
                output = commandHistory.map((cmd, i) => `  ${i + 1}  ${cmd}`).join('\n');
                addOutput(output, wrapper);
                break;
            case 'uname':
                if(args[0] === '-a') {
                    output = 'Linux kali-linux 6.5.0-kali3-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.5.6-1kali1 (2023-10-09) x86_64 GNU/Linux';
                } else {
                    output = 'Linux';
                }
                addOutput(output, wrapper);
                break;
            case 'neofetch':
                await simulateNeofetch(wrapper);
                break;
            case 'ping':
                await simulatePing(args, wrapper);
                break;
            case 'date':
                output = new Date().toString();
                addOutput(output, wrapper);
                break;
            case 'clear':
                terminal.innerHTML = '';
                return;
            case 'ifconfig':
                await simulateIfconfig(wrapper);
                break;
            case 'iwconfig':
                await simulateIwconfig(wrapper);
                break;
            case 'apt':
                await handleApt(args, wrapper);
                break;
            case 'echo':
                output = command.substring(5);
                addOutput(output, wrapper);
                break;
            default:
                output = `bash: ${command}: command not found`;
                addOutput(output, wrapper);
        }
    }
    
    function showCommandHelp(command, wrapper) {
        const helpTexts = {
            help: {
                description: 'Display information about builtin commands',
                usage: 'help',
                details: 'The help command displays a list of all available builtin commands in this terminal simulation.'
            },
            whoami: {
                description: 'Print the current user name',
                usage: 'whoami',
                details: 'Displays the name of the current user. In this simulation, it always returns "root".'
            },
            pwd: {
                description: 'Print working directory',
                usage: 'pwd',
                details: 'Displays the full path of the current working directory.'
            },
            ls: {
                description: 'List directory contents',
                usage: 'ls [FILE/DIRECTORY]...',
                details: 'List information about files and directories. Without arguments, lists current directory contents.'
            },
            cd: {
                description: 'Change the current directory',
                usage: 'cd [DIRECTORY]',
                details: 'Change the current working directory. Use "cd .." to go to parent directory, "cd" or "cd ~" to go to home directory.'
            },
            cat: {
                description: 'Concatenate and display files',
                usage: 'cat [FILE]',
                details: 'Display the contents of files. In this simulation, only predefined files have content.'
            },
            touch: {
                description: 'Create empty files',
                usage: 'touch [FILE]',
                details: 'Create empty files or update file timestamps. In this simulation, only creates empty files.'
            },
            mkdir: {
                description: 'Create directories',
                usage: 'mkdir [DIRECTORY]',
                details: 'Create new directories in the current working directory.'
            },
            date: {
                description: 'Display or set the system date and time',
                usage: 'date',
                details: 'Display the current date and time. Setting time is not supported in this simulation.'
            },
            clear: {
                description: 'Clear the terminal screen',
                usage: 'clear',
                details: 'Clear all previous command outputs from the terminal screen.'
            },
            history: {
                description: 'Display command history',
                usage: 'history',
                details: 'Show the list of previously executed commands in the current session.'
            },
            uname: {
                description: 'Print system information',
                usage: 'uname [-a]',
                details: 'Display system information. Use -a flag to show all available system information.'
            },
            neofetch: {
                description: 'Display system information with ASCII art',
                usage: 'neofetch',
                details: 'Show system information in a visually appealing format with ASCII art logo.'
            },
            ping: {
                description: 'Send ICMP ECHO_REQUEST to network hosts',
                usage: 'ping [HOST]',
                details: 'Send network requests to test connectivity to other hosts. Host defaults to google.com if not specified.'
            },
            ifconfig: {
                description: 'Configure network interface parameters',
                usage: 'ifconfig',
                details: 'Display or configure network interfaces. In this simulation, shows simulated network configuration.'
            },
            iwconfig: {
                description: 'Configure wireless network interfaces',
                usage: 'iwconfig',
                details: 'Display wireless interface configuration including ESSID, signal strength, and other parameters.'
            },
            apt: {
                description: 'APT package management utility',
                usage: 'apt [update|upgrade|install|autoremove]',
                details: 'Manage packages and system updates. Supports: update, upgrade, install, autoremove operations.'
            },
            echo: {
                description: 'Display a line of text',
                usage: 'echo [STRING]',
                details: 'Write arguments to the standard output. Useful for displaying text or variables.'
            }
        };

        const help = helpTexts[command];
        if (help) {
            const helpOutput = `
${command} - ${help.description}

Usage: ${help.usage}

Description:
  ${help.details}

Real Usage:
  In real Kali Linux, this command ${help.description.toLowerCase()} with various options and parameters.

Use 'help' to see all available commands.`;
            addOutput(helpOutput, wrapper);
        } else {
            addOutput(`No help available for: ${command}`, wrapper);
        }
    }
    
    function addOutput(text, wrapper, isHtml = false) {
        const outputLine = document.createElement('div');
        outputLine.className = 'terminal-line output-line';

        const outputDiv = document.createElement('div');
        outputDiv.className = 'output';

        if (isHtml) {
            outputDiv.innerHTML = text;
        } else {
            outputDiv.textContent = text;
        }

        outputLine.appendChild(outputDiv);
        wrapper.insertAdjacentElement('afterend', outputLine);
        terminal.scrollTop = terminal.scrollHeight;
    }

    // --- Simulation Functions ---
    async function simulateNeofetch(wrapper) {
        const output = `
<span class="prompt-red">               ,;</span>           <span class="prompt-red">root@kali-linux</span>
<span class="prompt-red">             ,;;'</span>          -----------------
<span class="prompt-red">            ,;;'</span>           <span class="color-white">OS:</span> Kali GNU/Linux Rolling x86_64
<span class="prompt-red">          ,;;;'</span>            <span class="color-white">Host:</span> VirtualBox 1.2
<span class="prompt-red">        ,;;;'</span>              <span class="color-white">Kernel:</span> 6.5.0-kali3-amd64
<span class="prompt-red">      ,;;;'</span>                <span class="color-white">Uptime:</span> ${randInt(1, 20)}h ${randInt(1, 59)}m
<span class="prompt-red">    ,;;;'</span>                  <span class="color-white">Packages:</span> 2890 (dpkg)
<span class="prompt-red">  ,;;;'</span>                    <span class="color-white">Shell:</span> bash 5.2.15
<span class="prompt-red">,;;;'</span>                      <span class="color-white">Resolution:</span> 1920x1080
<span class="prompt-red">''</span>                         <span class="color-white">Terminal:</span> html-terminal
                           <span class="color-white">CPU:</span> Intel i7-8750H (12) @ 4.1GHz
                           <span class="color-white">GPU:</span> VMware SVGA II Adapter
                           <span class="color-white">Memory:</span> ${randInt(1000, 3000)}MiB / 8023MiB
`;
        addOutput(output, wrapper, true);
    }
    
    async function simulatePing(args, wrapper) {
        const host = args[0] || 'google.com';
        const ip = randIP();
        let lastWrapper = wrapper;
        addOutput(`PING ${host} (${ip}) 56(84) bytes of data.`, lastWrapper);
        lastWrapper = terminal.lastChild;

        for (let i = 0; i < 4; i++) {
            await sleep(randInt(800, 1200));
            const time = (Math.random() * 30 + 10).toFixed(1);
            addOutput(`64 bytes from ${ip}: icmp_seq=${i+1} ttl=54 time=${time} ms`, lastWrapper);
            lastWrapper = terminal.lastChild;
        }

        await sleep(500);
        const stats = `
--- ${host} ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 10.512/21.321/30.450/8.312 ms
        `;
        addOutput(stats, lastWrapper);
    }

    async function simulateIfconfig(wrapper) {
        const rxb = randInt(500000, 900000);
        const txb = randInt(500000, 900000);
        const rxb_wlan = randInt(100000000, 200000000);
        const txb_wlan = randInt(20000000, 40000000);

        const output = `lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets ${randInt(10000, 12000)}  bytes ${rxb} (${(rxb/1024).toFixed(1)} KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets ${randInt(10000, 12000)}  bytes ${txb} (${(txb/1024).toFixed(1)} KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

wlan0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet ${randIP()}  netmask 255.255.255.0  broadcast 192.168.0.255
        inet6 ${randIPv6().substring(0, 24)}  prefixlen 64  scopeid 0x20<link>
        ether ${randMAC()}  txqueuelen 1000  (Ethernet)
        RX packets ${randInt(160000, 170000)}  bytes ${rxb_wlan} (${(rxb_wlan/1024/1024).toFixed(1)} MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets ${randInt(100000, 110000)}  bytes ${txb_wlan} (${(txb_wlan/1024/1024).toFixed(1)} MiB)
        TX errors 0  dropped ${randInt(0,10)} overruns 0  carrier 0  collisions 0`;
        addOutput(output, wrapper);
    }

    async function simulateIwconfig(wrapper) {
        const essid = ["MyHomeWifi", "CafeNet", "Airport_Free_WiFi", "AndroidAP", "NETGEAR-GUEST"][randInt(0, 4)];
        const output = `lo        no wireless extensions.

wlan0     IEEE 802.11  ESSID:"${essid}"  
          Mode:Managed  Frequency:${randInt(2,5)}.${randInt(100,600)} GHz  Access Point: ${randMAC()}   
          Bit Rate=${randInt(6, 144)} Mb/s   Tx-Power=20 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Encryption key:off
          Power Management:on
          Link Quality=${randInt(30, 70)}/70  Signal level=-${randInt(50, 80)} dBm  
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:${randInt(100, 20000)}   Missed beacon:0`;
        addOutput(output, wrapper);
    }

    async function handleApt(args, wrapper) {
        const action = args[0];
        const pkg = args[1] || 'example-package';
        
        if (action === 'update') {
            await simulateAptUpdate(wrapper);
        } else if (action === 'upgrade' || action === 'full-upgrade') {
            await simulateAptInstall(wrapper, 'upgrade', 30, 45);
        } else if (action === 'install') {
            await simulateAptInstall(wrapper, 'install', 1, 1, pkg);
        } else if (action === 'autoremove') {
            await simulateAptAutoremove(wrapper);
        } else {
            addOutput(`E: Invalid operation ${action}`, wrapper);
        }
    }
    
    async function simulateAptUpdate(wrapper) {
        const numLines = randInt(6, 30);
        const lines = [];
        
        for (let i = 1; i <= numLines; i++) {
            const isGet = Math.random() > 0.3;
            const repos = [
                'https://dl.google.com/linux/chrome/deb stable',
                'https://repo.protonvpn.com/debian stable',
                'https://pkg.cloudflare.com/cloudflared bookworm',
                'http://kali.download/kali kali-rolling',
                'http://http.kali.org/kali kali-rolling',
                'https://download.docker.com/linux/debian bookworm',
                'https://packages.microsoft.com/repos/code stable',
                'https://deb.nodesource.com/node_18.x nodistro'
            ];
            const repo = repos[randInt(0, repos.length - 1)];
            const types = ['InRelease', 'main amd64 Packages', 'main i386 Packages', 'universe amd64 Packages'];
            const type = types[randInt(0, types.length - 1)];
            
            if (isGet) {
                const sizes = ['1,825 B', '1,213 B', '34.0 kB', '21.0 MB', '1,542 B', '2.1 kB', '15.3 kB'];
                const size = sizes[randInt(0, sizes.length - 1)];
                lines.push(`Get:${i} ${repo} ${type} [${size}]`);
            } else {
                lines.push(`Hit:${i} ${repo} ${type}`);
            }
        }
        
        let lastWrapper = wrapper;
        for(const line of lines) {
            await sleep(randInt(100, 400));
            addOutput(line, lastWrapper);
            lastWrapper = terminal.lastChild;
        }

        let progress = 0;
        const totalSizeMB = randInt(15, 25) + Math.random();
        const progressLine = document.createElement('div');
        progressLine.className = 'terminal-line output-line';
        const progressDiv = document.createElement('div');
        progressDiv.className = 'output';
        progressLine.appendChild(progressDiv);

        lastWrapper.insertAdjacentElement('afterend', progressLine);
        lastWrapper = progressLine;

        while (progress < 100) {
            progress += randInt(5, 20);
            if (progress > 100) progress = 100;
            const downloadedMB = (totalSizeMB * progress / 100).toFixed(1);
            const totalKB = (totalSizeMB * 1024).toFixed(0);
            const currentKB = (totalSizeMB * 1024 * progress / 100).toFixed(0);
            progressDiv.textContent = `${progress}% [${numLines} Packages ${currentKB} kB/${totalKB} kB ${progress}%]`;
            await sleep(randInt(100, 500));
        }
        
        await sleep(500);
        addOutput(`Fetched ${totalSizeMB.toFixed(1)} MB in ${randInt(5,15)}s (${(totalSizeMB*1024/randInt(5,15)).toFixed(0)} kB/s)`, lastWrapper);
        addOutput('Reading package lists... Done', terminal.lastChild);
    }

    async function simulateAptInstall(wrapper, type, min, max, pkg) {
        const numPackages = randInt(min, max);
        let lastWrapper = wrapper;
        
        addOutput('Reading package lists... Done', lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(500);
        addOutput('Building dependency tree... Done', lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(500);
        addOutput('Reading state information... Done', lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(200);

        if(type === 'install') {
            addOutput(`The following NEW packages will be installed:\n  ${pkg}`, lastWrapper);
        } else {
             addOutput(`${numPackages} packages can be upgraded. Run 'apt list --upgradable' to see them.`, lastWrapper);
        }
        lastWrapper = terminal.lastChild;

        const totalInstall = type === 'install' ? 1 : 0;
        const totalUpgrade = type === 'upgrade' ? numPackages : 0;
        
        addOutput(`${totalUpgrade} upgraded, ${totalInstall} newly installed, 0 to remove and 0 not upgraded.`, lastWrapper);
        lastWrapper = terminal.lastChild;
        
        const needToGet = randInt(10, 100);
        addOutput(`Need to get ${needToGet} MB of archives.`, lastWrapper);
        lastWrapper = terminal.lastChild;
        
        addOutput(`After this operation, ${(needToGet * 1.2).toFixed(1)} MB of additional disk space will be used.`, lastWrapper);
        lastWrapper = terminal.lastChild;

        await sleep(1000);
        
        let progress = 0;
        const progressLine = document.createElement('div');
        progressLine.className = 'terminal-line output-line';
        const progressDiv = document.createElement('div');
        progressDiv.className = 'output';
        progressLine.appendChild(progressDiv);

        lastWrapper.insertAdjacentElement('afterend', progressLine);
        lastWrapper = progressLine;

        while (progress < 100) {
            progress += randInt(5, 15);
            if (progress > 100) progress = 100;
            
            const progressBar = `[${'#'.repeat(Math.floor(progress/10))}${'-'.repeat(10-Math.floor(progress/10))}] ${progress}%`;
            progressDiv.textContent = `Unpacking ${pkg} ... ${progressBar}`;
            
            await sleep(randInt(200, 400));
        }

        addOutput(`Setting up ${pkg} ...`, terminal.lastChild);
        lastWrapper = terminal.lastChild;
        await sleep(1000);
        addOutput(`Processing triggers for man-db ...`, lastWrapper);
    }

    async function simulateAptAutoremove(wrapper) {
        let lastWrapper = wrapper;
        const fakePackage = "android-sdk-platform-tools-common";
        
        addOutput('Reading package lists... Done', lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(500);
        addOutput('Building dependency tree... Done', lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(500);

        addOutput(`The following packages will be REMOVED:\n  ${fakePackage}`, lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(200);
        
        addOutput(`0 upgraded, 0 newly installed, 1 to remove and ${randInt(1000, 2000)} not upgraded.`, lastWrapper);
        lastWrapper = terminal.lastChild;
        await sleep(200);
        addOutput(`After this operation, 33.8 kB disk space will be freed.`, lastWrapper);
        lastWrapper = terminal.lastChild;

        const confirmationLine = document.createElement('div');
        confirmationLine.className = 'terminal-line';
        confirmationLine.innerHTML = `
            <div class="output">Do you want to continue? [Y/n]&nbsp;</div>
            <div class="input-container">
                <input type="text" class="input-field" style="width: 20px;" autofocus>
            </div>
        `;
        lastWrapper.insertAdjacentElement('afterend', confirmationLine);
        const confirmationInput = confirmationLine.querySelector('.input-field');
        confirmationInput.focus();

        const userChoice = await new Promise(resolve => {
            confirmationInput.addEventListener('keydown', function onKey(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    confirmationInput.removeEventListener('keydown', onKey);
                    resolve(confirmationInput.value.trim().toLowerCase());
                }
            });
        });

        confirmationLine.innerHTML = `<div class="output">Do you want to continue? [Y/n] ${userChoice || 'y'}</div>`;
        lastWrapper = confirmationLine;

        if (userChoice === 'n') {
            addOutput('Abort.', lastWrapper);
            return;
        }

        await sleep(800);
        const readingDbLine = document.createElement('div');
        readingDbLine.className = 'terminal-line output-line';
        lastWrapper.insertAdjacentElement('afterend', readingDbLine);
        const dbDiv = document.createElement('div');
        dbDiv.className = 'output';
        dbDiv.textContent = `(Reading database ... ${randInt(400000, 500000)} files and directories currently installed.)`;
        readingDbLine.appendChild(dbDiv);
        lastWrapper = readingDbLine;
        
        await sleep(1000);
        addOutput(`Removing ${fakePackage} (28.0.2+12) ...`, lastWrapper);
        await sleep(1000);
    }

    // Initial setup
    createNewInputLine();

    // Click anywhere to focus the current input
    document.body.addEventListener('click', (e) => {
        const currentInput = terminal.querySelector('.input-field:not([readonly])');
        if (currentInput) {
            currentInput.focus();
        }
    });
});
</script>

</body>
</html>
